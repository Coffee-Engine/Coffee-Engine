(function () {
    class sensing {
        date = new Date(Date.now());

        controllerSVG = `<svg style="width:100%; height:100%; padding:0px; margin:0px;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="279.53576"
    height="340.84147" viewBox="0,0,279.53576,340.84147">
    <g transform="translate(-100.23211,-9.57927)">
        <g data-paper-data="{&quot;isPaintingLayer&quot;:true}" fill-rule="nonzero" stroke="#2E8EB8"
            stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0"
            style="mix-blend-mode: normal">
            <path
                d="M150.94485,212.37807c0,-9.98887 8.09758,-18.08645 18.08645,-18.08645c9.98887,0 18.08646,8.09758 18.08646,18.08645c0,9.98887 -8.09759,18.08646 -18.08645,18.08646c-9.98887,0 -18.08645,-8.09759 -18.08645,-18.08645z"
                fill="none" stroke-width="2" stroke-linecap="butt" />
            <path style="cursor:pointer;" class="coffee-engine-controller-button" name="Left-Stick"
                d="M157.59428,212.37807c0,-6.3165 5.12052,-11.43702 11.43702,-11.43702c6.3165,0 11.43703,5.12052 11.43703,11.43702c0,6.3165 -5.12053,11.43702 -11.43703,11.43702c-6.3165,0 -11.43702,-5.12053 -11.43702,-11.43702z"
                fill="#2E8EB8" stroke-width="3" stroke-linecap="butt" />
            <path
                d="M259.66246,254.91587c0,-9.98887 8.09758,-18.08645 18.08645,-18.08645c9.98887,0 18.08646,8.09758 18.08646,18.08645c0,9.98887 -8.09758,18.08646 -18.08645,18.08646c-9.98887,0 -18.08645,-8.09759 -18.08645,-18.08645z"
                fill="none" stroke-width="2" stroke-linecap="butt" />
            <path style="cursor:pointer;" class="coffee-engine-controller-button" name="Right-Stick"
                d="M266.31189,254.91587c0,-6.3165 5.12053,-11.43702 11.43702,-11.43702c6.31649,0 11.43703,5.12052 11.43703,11.43702c0,6.3165 -5.12053,11.43702 -11.43703,11.43702c-6.31649,0 -11.43702,-5.12052 -11.43702,-11.43702z"
                fill="#2E8EB8" stroke-width="3" stroke-linecap="butt" />
            <path style="cursor:pointer;" class="coffee-engine-controller-button" name="Left-Face"
                d="M284.69905,212.37807c0,-4.93173 3.99795,-8.92968 8.92968,-8.92968c4.93173,0 8.92969,3.99795 8.92969,8.92968c0,4.93173 -3.99795,8.92968 -8.92969,8.92968c-4.93173,0 -8.92968,-3.99795 -8.92968,-8.92968z"
                fill="#2E8EB8" stroke-width="3" stroke-linecap="butt" />
            <path style="cursor:pointer;" class="coffee-engine-controller-button" name="Right-Face"
                d="M322.81062,212.37807c0,-4.93173 3.99795,-8.92968 8.92968,-8.92968c4.93173,0 8.92968,3.99795 8.92968,8.92968c0,4.93173 -3.99795,8.92968 -8.92968,8.92968c-4.93173,0 -8.92968,-3.99795 -8.92968,-8.92968z"
                fill="#2E8EB8" stroke-width="3" stroke-linecap="butt" />
            <path style="cursor:pointer;" class="coffee-engine-controller-button" name="Bottom-Face"
                d="M312.68452,240.36354c-4.93173,0 -8.92968,-3.99795 -8.92968,-8.92968c0,-4.93173 3.99795,-8.92969 8.92968,-8.92969c4.93173,0 8.92968,3.99796 8.92968,8.92969c0,4.93173 -3.99795,8.92968 -8.92968,8.92968z"
                fill="#2E8EB8" stroke-width="3" stroke-linecap="butt" />
            <path style="cursor:pointer;" class="coffee-engine-controller-button" name="Top-Face"
                d="M312.68452,202.25197c-4.93173,0 -8.92968,-3.99795 -8.92968,-8.92968c0,-4.93173 3.99795,-8.92968 8.92968,-8.92968c4.93173,0 8.92968,3.99795 8.92968,8.92968c0,4.93173 -3.99795,8.92968 -8.92968,8.92968z"
                fill="#2E8EB8" stroke-width="3" stroke-linecap="butt" />
            <path style="cursor:pointer;" class="coffee-engine-controller-button" name="Start"
                d="M255.49737,210.91707c0,-3.04398 2.46763,-5.51162 5.51162,-5.51162c3.04399,0 5.51162,2.46764 5.51162,5.51162c0,3.04398 -2.46764,5.51162 -5.51162,5.51162c-3.04399,0 -5.51162,-2.46763 -5.51162,-5.51162z"
                fill="#2E8EB8" stroke-width="3" stroke-linecap="butt" />
            <path style="cursor:pointer;" class="coffee-engine-controller-button" name="Select"
                d="M214.0674,210.91707c0,-3.04398 2.46764,-5.51162 5.51162,-5.51162c3.04398,0 5.51162,2.46764 5.51162,5.51162c0,3.04398 -2.46764,5.51162 -5.51162,5.51162c-3.04398,0 -5.51162,-2.46763 -5.51162,-5.51162z"
                fill="#2E8EB8" stroke-width="3" stroke-linecap="butt" />
            <path style="cursor:pointer;" class="coffee-engine-controller-button" name="DPad-Up" d="M196.79981,248.25108v-14.99579h13.26049v14.99579l-6.31452,6.66479z" fill="#2E8EB8" stroke-width="3"
                stroke-linecap="butt" />
            <path style="cursor:pointer;" class="coffee-engine-controller-button" name="DPad-Down" d="M203.74578,254.91587l6.31453,6.66479v14.99579h-13.2605v-14.99579z"
                data-paper-data="{&quot;index&quot;:null}" fill="#2E8EB8" stroke-width="3" stroke-linecap="butt" />
            <path style="cursor:pointer;" class="coffee-engine-controller-button" name="DPad-Left" d="M196.76526,261.54612h-14.99578v-13.26049h14.99578l6.66479,6.31452z" fill="#2E8EB8" stroke-width="3"
                stroke-linecap="butt" />
            <path style="cursor:pointer;" class="coffee-engine-controller-button" name="DPad-Right" d="M203.43006,254.60015l6.66479,-6.31452h14.99579v13.26049h-14.99579z"
                data-paper-data="{&quot;index&quot;:null}" fill="#2E8EB8" stroke-width="3" stroke-linecap="butt" />
            <path style="cursor:pointer;" class="coffee-engine-controller-button" name="Left-Bumper"
                d="M196.8313,163.82593c0,0 -20.97618,2.33735 -30.21841,5.28476c-9.08705,2.89792 -24.77733,12.25375 -24.77733,12.25375c0,0 3.37754,-5.76871 9.10648,-10.73161c4.28204,-3.70947 10.43061,-6.69232 14.4655,-7.97907c4.18376,-1.33423 16.30528,-3.65316 22.77953,-3.08425c7.24131,0.63631 8.64423,4.25643 8.64423,4.25643z"
                fill="#2E8EB8" stroke-width="3" stroke-linecap="round" />
            <path style="cursor:pointer;" class="coffee-engine-controller-button" name="Right-Bumper"
                d="M283.08491,163.82594c0,0 1.40292,-3.62012 8.64423,-4.25643c6.47426,-0.56891 18.59576,1.75002 22.77953,3.08425c4.03489,1.28675 10.18346,4.2696 14.46551,7.97907c5.72894,4.9629 9.10648,10.73161 9.10648,10.73161c0,0 -15.69029,-9.35583 -24.77733,-12.25375c-9.24223,-2.94741 -30.21841,-5.28476 -30.21841,-5.28476z"
                data-paper-data="{&quot;index&quot;:null}" fill="#2E8EB8" stroke-width="3" stroke-linecap="round" />
            <path
                d="M339.04996,182.44215c0,0 72.76366,133.40457 21.31712,165.64611c-12.18895,7.63882 -34.60059,-19.32743 -48.58353,-36.08752c-6.38703,-7.65556 -12.43754,-12.04404 -12.43754,-12.04404h-118.69202c0,0 -6.05051,4.38849 -12.43754,12.04404c-13.98294,16.76009 -36.39458,43.72634 -48.58353,36.08752c-51.44654,-32.24154 21.31712,-165.64612 21.31712,-165.64612"
                fill="none" stroke-width="2" stroke-linecap="round" />
            <path d="M196.67101,163.84837h86.0464" fill="none" stroke-width="2" stroke-linecap="round" />
            <path
                d="M345.23961,118.43914c0,0 -4.53448,5.33814 -14.67152,11.37681c-12.46883,7.42772 -39.66803,8.72321 -89.51153,8.47995c-42.24458,-0.20618 -70.89973,0.21688 -85.56429,-6.86088c-16.77088,-8.09436 -20.7319,-12.99587 -20.7319,-12.99587c0,0 -22.3672,-18.88154 -30.22,-45.48364c-8.10716,-27.46379 -1.37059,-62.6711 20.83593,-62.37438c31.88266,0.42601 53.37655,52.68905 53.37655,52.68905c0,0 40.15391,1.75196 60.43195,1.75196c20.54976,0 62.06232,-1.75196 62.06232,-1.75196c0,0 21.4939,-52.26305 53.37655,-52.68905c22.20652,-0.29672 28.94309,34.91058 20.83593,62.37437c-7.8528,26.6021 -30.22,45.48363 -30.22,45.48363z"
                fill="none" stroke-width="2" stroke-linecap="round" />
            <path style="cursor:pointer;" class="coffee-engine-controller-button" name="Left-Trigger"
                d="M174.69727,97.91381c0,0 -14.65452,6.03367 -21.75472,7.26594c-6.68003,1.15935 -19.66293,-0.07774 -19.66293,-0.07774c0,0 -8.42564,-41.92656 16.22015,-47.46047c18.98057,-4.26185 25.1975,40.27228 25.1975,40.27228z"
                fill="#2E8EB8" stroke-width="3" stroke-linecap="round" />
            <path style="cursor:pointer;" class="coffee-engine-controller-button" name="Left-Bumper"
                d="M174.69727,97.57153c0,0 5.88638,2.70289 9.64299,3.48203c3.9366,0.81648 13.4619,1.31009 13.4619,1.31009v32.34684c0,0 -30.64465,0.1625 -41.44989,-4.55007c-20.98868,-9.15393 -22.90149,-24.71612 -22.90149,-24.71612c0,0 14.16154,0.86932 21.00271,-0.43647c6.90703,-1.31835 20.24378,-7.4363 20.24378,-7.4363z"
                fill="#2E8EB8" stroke-width="3" stroke-linecap="round" />
            <path style="cursor:pointer;" class="coffee-engine-controller-button" name="Right-Trigger"
                d="M330.58124,57.62627c24.64579,5.53391 16.22015,47.46047 16.22015,47.46047c0,0 -14.43722,0.88125 -21.29303,-0.30861c-6.94881,-1.20599 -20.12462,-6.87958 -20.12462,-6.87958c0,0 6.21694,-44.53413 25.1975,-40.27228z"
                data-paper-data="{&quot;index&quot;:null}" fill="#2E8EB8" stroke-width="3" stroke-linecap="round" />
            <path style="cursor:pointer;" class="coffee-engine-controller-button" name="Right-Bumper"
                d="M346.63025,105.42904c0,0 -1.91281,15.56219 -22.90149,24.71612c-10.80524,4.71256 -41.44989,4.55007 -41.44989,4.55007v-32.34684c0,0 9.5253,-0.49361 13.4619,-1.31009c3.75661,-0.77915 9.64299,-3.48203 9.64299,-3.48203c0,0 12.03209,5.63548 18.72607,6.91317c7.03764,1.34328 22.52042,0.9596 22.52042,0.9596z"
                data-paper-data="{&quot;index&quot;:null}" fill="#2E8EB8" stroke-width="3" stroke-linecap="round" />
        </g>
    </g>
</svg>`;

        controllerAxisSVG = `<svg version="1.1" style="width:100%; height:100%; padding:0px; margin:0px;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="279.53576"
    height="340.84147" viewBox="0,0,279.53576,190.84147">
    <g transform="translate(-100.23211,-150.57927)">
        <g data-paper-data="{&quot;isPaintingLayer&quot;:true}" fill-rule="nonzero" stroke="#2E8EB8"
            stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0"
            style="mix-blend-mode: normal">
            <path
                d="M150.94485,212.37807c0,-9.98887 8.09758,-18.08645 18.08645,-18.08645c9.98887,0 18.08646,8.09758 18.08646,18.08645c0,9.98887 -8.09759,18.08646 -18.08645,18.08646c-9.98887,0 -18.08645,-8.09759 -18.08645,-18.08645z"
                fill="none" stroke-width="2" stroke-linecap="butt" />
            <path
                d="M157.59428,212.37807c0,-6.3165 5.12052,-11.43702 11.43702,-11.43702c6.3165,0 11.43703,5.12052 11.43703,11.43702c0,6.3165 -5.12053,11.43702 -11.43703,11.43702c-6.3165,0 -11.43702,-5.12053 -11.43702,-11.43702z"
                fill="none" stroke-width="3" stroke-linecap="butt" />
            <path
                d="M259.66246,254.91587c0,-9.98887 8.09758,-18.08645 18.08645,-18.08645c9.98887,0 18.08646,8.09758 18.08646,18.08645c0,9.98887 -8.09758,18.08646 -18.08645,18.08646c-9.98887,0 -18.08645,-8.09759 -18.08645,-18.08645z"
                fill="none" stroke-width="2" stroke-linecap="butt" />
            <path
                d="M266.31189,254.91587c0,-6.3165 5.12053,-11.43702 11.43702,-11.43702c6.31649,0 11.43703,5.12052 11.43703,11.43702c0,6.3165 -5.12053,11.43702 -11.43703,11.43702c-6.31649,0 -11.43702,-5.12052 -11.43702,-11.43702z"
                fill="none" stroke-width="3" stroke-linecap="butt" />
            <path
                d="M284.69905,212.37807c0,-4.93173 3.99795,-8.92968 8.92968,-8.92968c4.93173,0 8.92969,3.99795 8.92969,8.92968c0,4.93173 -3.99795,8.92968 -8.92969,8.92968c-4.93173,0 -8.92968,-3.99795 -8.92968,-8.92968z"
                fill="none" stroke-width="3" stroke-linecap="butt" />
            <path
                d="M322.81062,212.37807c0,-4.93173 3.99795,-8.92968 8.92968,-8.92968c4.93173,0 8.92968,3.99795 8.92968,8.92968c0,4.93173 -3.99795,8.92968 -8.92968,8.92968c-4.93173,0 -8.92968,-3.99795 -8.92968,-8.92968z"
                fill="none" stroke-width="3" stroke-linecap="butt" />
            <path
                d="M312.68452,240.36354c-4.93173,0 -8.92968,-3.99795 -8.92968,-8.92968c0,-4.93173 3.99795,-8.92969 8.92968,-8.92969c4.93173,0 8.92968,3.99796 8.92968,8.92969c0,4.93173 -3.99795,8.92968 -8.92968,8.92968z"
                fill="none" stroke-width="3" stroke-linecap="butt" />
            <path
                d="M312.68452,202.25197c-4.93173,0 -8.92968,-3.99795 -8.92968,-8.92968c0,-4.93173 3.99795,-8.92968 8.92968,-8.92968c4.93173,0 8.92968,3.99795 8.92968,8.92968c0,4.93173 -3.99795,8.92968 -8.92968,8.92968z"
                fill="none" stroke-width="3" stroke-linecap="butt" />
            <path
                d="M255.49737,210.91707c0,-3.04398 2.46763,-5.51162 5.51162,-5.51162c3.04399,0 5.51162,2.46764 5.51162,5.51162c0,3.04398 -2.46764,5.51162 -5.51162,5.51162c-3.04399,0 -5.51162,-2.46763 -5.51162,-5.51162z"
                fill="none" stroke-width="3" stroke-linecap="butt" />
            <path
                d="M214.0674,210.91707c0,-3.04398 2.46764,-5.51162 5.51162,-5.51162c3.04398,0 5.51162,2.46764 5.51162,5.51162c0,3.04398 -2.46764,5.51162 -5.51162,5.51162c-3.04398,0 -5.51162,-2.46763 -5.51162,-5.51162z"
                fill="none" stroke-width="3" stroke-linecap="butt" />
            <path d="M196.79981,248.25108v-14.99579h13.26049v14.99579l-6.31452,6.66479z" fill="none" stroke-width="3"
                stroke-linecap="butt" />
            <path d="M203.74578,254.91587l6.31453,6.66479v14.99579h-13.2605v-14.99579z"
                data-paper-data="{&quot;index&quot;:null}" fill="none" stroke-width="3" stroke-linecap="butt" />
            <path d="M196.76526,261.54612h-14.99578v-13.26049h14.99578l6.66479,6.31452z" fill="none" stroke-width="3"
                stroke-linecap="butt" />
            <path d="M203.43006,254.60015l6.66479,-6.31452h14.99579v13.26049h-14.99579z"
                data-paper-data="{&quot;index&quot;:null}" fill="none" stroke-width="3" stroke-linecap="butt" />
            <path
                d="M196.8313,163.82593c0,0 -20.97618,2.33735 -30.21841,5.28476c-9.08705,2.89792 -24.77733,12.25375 -24.77733,12.25375c0,0 3.37754,-5.76871 9.10648,-10.73161c4.28204,-3.70947 10.43061,-6.69232 14.4655,-7.97907c4.18376,-1.33423 16.30528,-3.65316 22.77953,-3.08425c7.24131,0.63631 8.64423,4.25643 8.64423,4.25643z"
                fill="none" stroke-width="3" stroke-linecap="round" />
            <path
                d="M283.08491,163.82594c0,0 1.40292,-3.62012 8.64423,-4.25643c6.47426,-0.56891 18.59576,1.75002 22.77953,3.08425c4.03489,1.28675 10.18346,4.2696 14.46551,7.97907c5.72894,4.9629 9.10648,10.73161 9.10648,10.73161c0,0 -15.69029,-9.35583 -24.77733,-12.25375c-9.24223,-2.94741 -30.21841,-5.28476 -30.21841,-5.28476z"
                data-paper-data="{&quot;index&quot;:null}" fill="none" stroke-width="3" stroke-linecap="round" />
            <path
                d="M339.04996,182.44215c0,0 72.76366,133.40457 21.31712,165.64611c-12.18895,7.63882 -34.60059,-19.32743 -48.58353,-36.08752c-6.38703,-7.65556 -12.43754,-12.04404 -12.43754,-12.04404h-118.69202c0,0 -6.05051,4.38849 -12.43754,12.04404c-13.98294,16.76009 -36.39458,43.72634 -48.58353,36.08752c-51.44654,-32.24154 21.31712,-165.64612 21.31712,-165.64612"
                fill="none" stroke-width="2" stroke-linecap="round" />
            <path d="M196.67101,163.84837h86.0464" fill="none" stroke-width="2" stroke-linecap="round" />
            <path
                d="M160.7641,205.24275c0,0 4.76333,-4.23263 8.4588,-4.23263c3.51575,0 8.15603,4.23263 8.15603,4.23263l-8.34488,7.30655z"
                fill="#2E8EB8" stroke-width="0" stroke-linecap="butt" />
            <path
                d="M168.99385,212.56489l8.24784,7.20952c0,0 -4.54325,4.32967 -8.059,4.32967c-3.69547,0 -8.36177,-4.32967 -8.36177,-4.32967z"
                data-paper-data="{&quot;index&quot;:null}" fill="#2E8EB8" stroke-width="0" stroke-linecap="butt" />
            <g fill="#2E8EB8" stroke-width="0" stroke-linecap="butt">
                <path style="cursor:pointer;" class="coffee-engine-controller-button" name="left-stick-y"
                    d="M160.7641,205.24275c0,0 4.76333,-4.23263 8.4588,-4.23263c3.51575,0 8.15603,4.23263 8.15603,4.23263l-8.34488,7.30655z" />
                <path style="cursor:pointer;" class="coffee-engine-controller-button" name="left-stick-y"
                    d="M168.99385,212.56489l8.24784,7.20952c0,0 -4.54325,4.32967 -8.059,4.32967c-3.69547,0 -8.36177,-4.32967 -8.36177,-4.32967z"
                    data-paper-data="{&quot;index&quot;:null}" />
            </g>
            <g fill="#2E8EB8" stroke-width="0" stroke-linecap="butt">
                <path style="cursor:pointer;" class="coffee-engine-controller-button" name="left-stick-x"
                    d="M161.75718,220.86451c0,0 -4.23264,-4.76333 -4.23263,-8.4588c0,-3.51575 4.23263,-8.15603 4.23263,-8.15603l7.30655,8.34488z" />
                <path style="cursor:pointer;" class="coffee-engine-controller-button" name="left-stick-x"
                    d="M169.07932,212.63476l7.20952,-8.24784c0,0 4.32966,4.54325 4.32966,8.059c0,3.69547 -4.32966,8.36177 -4.32966,8.36177z"
                    data-paper-data="{&quot;index&quot;:null}" />
            </g>
            <g fill="#2E8EB8" stroke-width="0" stroke-linecap="butt">
                <path style="cursor:pointer;" class="coffee-engine-controller-button" name="right-stick-y"
                    d="M269.4415,247.60153c0,0 4.76333,-4.23263 8.4588,-4.23263c3.51575,0 8.15603,4.23263 8.15603,4.23263l-8.34488,7.30655z" />
                <path style="cursor:pointer;" class="coffee-engine-controller-button" name="right-stick-y"
                    d="M277.67125,254.92367l8.24784,7.20952c0,0 -4.54325,4.32966 -8.059,4.32966c-3.69547,0 -8.36177,-4.32966 -8.36177,-4.32966z"
                    data-paper-data="{&quot;index&quot;:null}" />
            </g>
            <g fill="#2E8EB8" stroke-width="0" stroke-linecap="butt">
                <path style="cursor:pointer;" class="coffee-engine-controller-button" name="right-stick-x"
                    d="M270.43457,263.22329c0,0 -4.23264,-4.76333 -4.23264,-8.4588c0,-3.51575 4.23263,-8.15603 4.23263,-8.15603l7.30655,8.34488z" />
                <path style="cursor:pointer;" class="coffee-engine-controller-button" name="right-stick-x"
                    d="M277.75671,254.99354l7.20951,-8.24784c0,0 4.32967,4.54325 4.32967,8.059c0,3.69547 -4.32967,8.36178 -4.32967,8.36178z"
                    data-paper-data="{&quot;index&quot;:null}" />
            </g>
        </g>
    </g>
</svg>`;

        getInfo() {
            return {
                id: "sensing",
                name: editor.language["sugarcube.sensing"],
                color1: "#5CB1D6",
                color2: "#47A8D1",
                color3: "#2E8EB8",
                showColor: true,
                menuIconURI: "data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSI3MC41IiBoZWlnaHQ9IjcwLjUiIHZpZXdCb3g9IjAsMCw3MC41LDcwLjUiPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yMDQuNzUwMDEsLTE0NC43NSkiPjxnIGRhdGEtcGFwZXItZGF0YT0ieyZxdW90O2lzUGFpbnRpbmdMYXllciZxdW90Ozp0cnVlfSIgZmlsbC1ydWxlPSJub256ZXJvIiBzdHJva2UtbGluZWpvaW49Im1pdGVyIiBzdHJva2UtbWl0ZXJsaW1pdD0iMTAiIHN0cm9rZS1kYXNoYXJyYXk9IiIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjAiIHN0eWxlPSJtaXgtYmxlbmQtbW9kZTogbm9ybWFsIj48cGF0aCBkPSJNMjQ4Ljc4MzIxLDE3OS44OTYxMWMyLjY0MTA4LDIuNDUwMDIgMi43OTU5Niw2LjU3NzE3IDAuMzQ1OTQsOS4yMTgyNGMtMi40NTAwMiwyLjY0MTA4IC02LjU3NzE3LDIuNzk1OTYgLTkuMjE4MjQsMC4zNDU5NGMtMi42NDEwOCwtMi40NTAwMiAtMi43OTU5NiwtNi41NzcxNyAtMC4zNDU5NCwtOS4yMTgyNGMyLjQ1MDAyLC0yLjY0MTA4IDYuNTc3MTcsLTIuNzk1OTYgOS4yMTgyNCwtMC4zNDU5NHoiIGZpbGw9IiNmZmZmZmYiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIwIiBzdHJva2UtbGluZWNhcD0iYnV0dCIvPjxwYXRoIGQ9Ik0yNTQuMzI4ODUsMTY4Ljc2OTg2bDEzLjA1MjA0LDEyLjEwNzg1bC0yNS4wOTcyNywyNy4wNTQzOWwtMTMuMDUyMDQsLTEyLjEwNzg1bDYuMzUwNjcsLTYuODQ1OWMwLjUwOTg0LDEuMDQzMzYgMS4yMTcsMi4wMTIxMiAyLjExOTM3LDIuODQ5MjFjMy45MjY5MywzLjY0Mjg1IDEwLjA2MzQzLDMuNDEyNTYgMTMuNzA2MjgsLTAuNTE0MzZjMy42NDI4NSwtMy45MjY5MyAzLjQxMjU2LC0xMC4wNjM0MyAtMC41MTQzNiwtMTMuNzA2MjhjLTAuOTAyMzcsLTAuODM3MDkgLTEuOTIxNCwtMS40Njk2NSAtMy4wMDAwNCwtMS44OTk4NnoiIGZpbGw9IiNmZmZmZmYiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIwIiBzdHJva2UtbGluZWNhcD0iYnV0dCIvPjxwYXRoIGQ9Ik0yMjUuODcyNzksMTg4LjkzNzZjMCwwIC0wLjUzMzU5LC03LjM4NjU0IDYuNDc4NDgsLTE1LjMwMjQ5YzcuNDI1NjYsLTguMzgyODcgMTQuODU4NTcsLTcuNjk4NDUgMTQuODU4NTcsLTcuNjk4NDUiIGZpbGw9Im5vbmUiIHN0cm9rZT0iI2ZmZmZmZiIgc3Ryb2tlLXdpZHRoPSI2IiBzdHJva2UtbGluZWNhcD0icm91bmQiLz48cGF0aCBkPSJNMjEzLjA0ODE1LDE5Ny45MjE1NWMwLDAgLTMuNjEyNTQsLTE2Ljk2Nzk1IDEwLjEyNzY2LC0zMi43MTUyN2MxNC41NTA2MywtMTYuNjc2MTMgMzIuMDMxNTEsLTEyLjczMTU1IDMyLjAzMTUxLC0xMi43MzE1NSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjZmZmZmZmIiBzdHJva2Utd2lkdGg9IjYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPjxwYXRoIGQ9Ik0yMDQuNzUwMDIsMjE1LjI1di03MC41aDcwLjV2NzAuNXoiIGZpbGw9Im5vbmUiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIwIiBzdHJva2UtbGluZWNhcD0iYnV0dCIvPjwvZz48L2c+PC9zdmc+PCEtLXJvdGF0aW9uQ2VudGVyOjM1LjI0OTk4NTAwMDAwMDAxOjM1LjI1MDAwNDk5OTk5OTk5LS0+",
                blocks: [
                    {
                        opcode: "isTouching",
                        type: sugarcube.BlockType.BOOLEAN,
                        text: editor.language["sugarcube.sensing.block.isTouching"],
                    },
                    {
                        opcode: "pushDirections", 
                        type: sugarcube.BlockType.ARRAY,
                        text: editor.language["sugarcube.sensing.block.pushDirections"],
                        filter: ["PhysicalNode2D", "PhysicalNode3D"],
                    },
                    "---",
                    {
                        opcode: "isKeyDown",
                        type: sugarcube.BlockType.BOOLEAN,
                        text: editor.language["sugarcube.sensing.block.isKeyDown"],
                        arguments: {
                            key: {
                                type: sugarcube.ArgumentType.STRING,
                                menu: "keys",
                            },
                        },
                    },
                    "---",
                    {
                        opcode: "mouseDown",
                        type: sugarcube.BlockType.BOOLEAN,
                        text: editor.language["sugarcube.sensing.block.mouseDown"],
                        arguments: {
                            button: {
                                type: sugarcube.ArgumentType.STRING,
                                menu: "mouseButtons",
                            },
                        },
                    },
                    {
                        opcode: "mouseX",
                        type: sugarcube.BlockType.REPORTER,
                        text: editor.language["sugarcube.sensing.block.mouseX"],
                    },
                    {
                        opcode: "mouseY",
                        type: sugarcube.BlockType.REPORTER,
                        text: editor.language["sugarcube.sensing.block.mouseY"],
                    },
                    "---",
                    {
                        opcode: "lockMouse",
                        type: sugarcube.BlockType.COMMAND,
                        text: editor.language["sugarcube.sensing.block.lockMouse"],
                        arguments: {
                            mode: {
                                menu:"modeMenu"
                            }
                        }
                    },
                    {
                        opcode: "lockStatus",
                        type: sugarcube.BlockType.BOOLEAN,
                        text: editor.language["sugarcube.sensing.block.lockStatus"],
                    },
                    "---",
                    {
                        opcode: "controllerConnected",
                        type: sugarcube.BlockType.BOOLEAN,
                        text: editor.language["sugarcube.sensing.block.controllerConnected"],
                        arguments: {
                            id: {
                                menu: "controllers",
                            },
                        },
                    },
                    {
                        opcode: "controllerID",
                        type: sugarcube.BlockType.REPORTER,
                        text: editor.language["sugarcube.sensing.block.controllerID"],
                        arguments: {
                            id: {
                                menu: "controllers",
                            },
                        },
                    },
                    {
                        opcode: "controllerAxis",
                        type: sugarcube.BlockType.REPORTER,
                        text: editor.language["sugarcube.sensing.block.controllerAxis"],
                        arguments: {
                            axis: {
                                type: sugarcube.ArgumentType.CUSTOM,
                                customType: "Controller_Axis",
                                defaultValue: "left-stick-y",
                            },
                            id: {
                                menu: "controllers",
                            },
                        },
                    },
                    {
                        opcode: "controllerButtonValue",
                        type: sugarcube.BlockType.REPORTER,
                        text: editor.language["sugarcube.sensing.block.controllerButtonValue"],
                        arguments: {
                            button: {
                                type: sugarcube.ArgumentType.CUSTOM,
                                customType: "Controller",
                                defaultValue: "Bottom-Face",
                            },
                            id: {
                                menu: "controllers",
                            },
                        },
                    },
                    {
                        opcode: "controllerButton",
                        type: sugarcube.BlockType.BOOLEAN,
                        text: editor.language["sugarcube.sensing.block.controllerButton"],
                        arguments: {
                            button: {
                                type: sugarcube.ArgumentType.CUSTOM,
                                customType: "Controller",
                                defaultValue: "Bottom-Face",
                            },
                            id: {
                                menu: "controllers",
                            },
                        },
                    },
                    "---",
                    {
                        opcode: "timer",
                        type: sugarcube.BlockType.REPORTER,
                        text: editor.language["sugarcube.sensing.block.timer"],
                    },
                    {
                        opcode: "deltaTime",
                        type: sugarcube.BlockType.REPORTER,
                        text: editor.language["sugarcube.sensing.block.deltaTime"],
                    },
                    {
                        opcode: "dayMonthYear",
                        type: sugarcube.BlockType.REPORTER,
                        text: editor.language["sugarcube.sensing.block.dayMonthYear"],
                        arguments: {
                            timespan: {
                                menu: "timespans",
                            },
                        },
                    },
                ],
                menus: {
                    keys: {
                        items: sugarcube.commonKeys,
                        acceptReporters: true,
                    },
                    mouseButtons: {
                        items: [
                            { text: editor.language["sugarcube.sensing.menu.mouseButtons.primary"], value: "0" },
                            { text: editor.language["sugarcube.sensing.menu.mouseButtons.secondary"], value: "2" },
                            { text: editor.language["sugarcube.sensing.menu.mouseButtons.tertiary"], value: "1" },
                            //I have learned these are called the orders of magnitude.
                            { text: editor.language["sugarcube.sensing.menu.mouseButtons.quaternary"], value: "4" },
                            { text: editor.language["sugarcube.sensing.menu.mouseButtons.quinary"], value: "5" },
                        ],
                        acceptReporters: true,
                    },
                    modeMenu: {
                        items:[
                            { text: editor.language["sugarcube.sensing.menu.lockStatus.lock"], value: "true" },
                            { text: editor.language["sugarcube.sensing.menu.lockStatus.unlock"], value: "false" },
                        ],
                        acceptReporters: true,
                    },
                    controllers: {
                        items: ["1", "2", "3", "4"],
                        acceptReporters: true,
                    },
                    timespans: {
                        items: [
                            { text: editor.language["sugarcube.sensing.menu.timespans.century"], value: "getCentury" },
                            { text: editor.language["sugarcube.sensing.menu.timespans.decade"], value: "getDecade" },
                            { text: editor.language["sugarcube.sensing.menu.timespans.year"], value: "getFullYear" },
                            { text: editor.language["sugarcube.sensing.menu.timespans.month"], value: "getMonth" },
                            { text: editor.language["sugarcube.sensing.menu.timespans.day"], value: "getDate" },
                            { text: editor.language["sugarcube.sensing.menu.timespans.weekday"], value: "getDay" },
                            { text: editor.language["sugarcube.sensing.menu.timespans.hour"], value: "getHours" },
                            { text: editor.language["sugarcube.sensing.menu.timespans.minute"], value: "getMinutes" },
                            { text: editor.language["sugarcube.sensing.menu.timespans.second"], value: "getSeconds" },
                            { text: editor.language["sugarcube.sensing.menu.timespans.millisecond"], value: "getMilliseconds" },
                        ],
                    },
                },
                fields: {
                    Controller: {
                        acceptReporters: true,
                        isDropdown: true,

                        //Our custom editor
                        editor: "controller_Editor",
                        size: [256, 256],

                        //Stuff
                        initilize: "controller_Init",
                        manualNodeValue: true,

                        render: "controller_Value_Render",
                    },
                    Controller_Axis: {
                        acceptReporters: true,
                        isDropdown: true,

                        //Our custom editor
                        editor: "controller_Axis_Editor",
                        size: [256, 256],

                        //Stuff
                        initilize: "controller_Init",
                        manualNodeValue: true,

                        render: "controller_Value_Render",
                    },
                },
            };
        }

        //Collision
        isTouching(args, { target }) {
            return sugarcube.cast.toBoolean(target.detectCollisions());
        }

        pushDirections(args, { target }) {
            const outputs = [];
            for (let outputID in target.outputAxis) {
                const pushObject = target.outputAxis[outputID];
                outputs.push(pushObject.pushVector.mul(pushObject.pushLength));
            }

            return outputs;
        }

        //Key stuff
        isKeyDown({ key }) {
            return sugarcube.cast.toBoolean(coffeeEngine.inputs.keys[key]);
        }

        //Mouse stuff
        mouseDown({ button }) {
            return sugarcube.cast.toBoolean(coffeeEngine.inputs.mouse[button]);
        }

        mouseX() {
            return sugarcube.cast.toNumber(
                sugarcube.cast.toBoolean(coffeeEngine.inputs.mouse.locked) ? 
                coffeeEngine.inputs.mouse.movementX : 
                coffeeEngine.inputs.mouse.screenX
            );
        }

        mouseY() {
            return sugarcube.cast.toNumber(
                sugarcube.cast.toBoolean(coffeeEngine.inputs.mouse.locked) ? 
                coffeeEngine.inputs.mouse.movementY : 
                coffeeEngine.inputs.mouse.screenY
            );
        }

        lockMouse(mode) {
            coffeeEngine.inputs.mouse.locked = sugarcube.cast.toBoolean(mode);
        }

        lockStatus() {
            return sugarcube.cast.toBoolean(coffeeEngine.inputs.mouse.locked);
        }

        //Controller stuff
        //Really simple!
        controllerConnected({ id }) {
            return sugarcube.cast.toBoolean(coffeeEngine.inputs.gamepads[id].object);
        }

        controllerAxis({ axis, id }) {
            //Make some checks and balances
            if (!coffeeEngine.inputs.gamepads[id].axes) return 0;
            const axisConverted = coffeeEngine.inputs.axisNameToID[axis];
            if (!coffeeEngine.inputs.gamepads[id].axes[axisConverted]) return 0;

            //Get and cast
            return sugarcube.cast.toNumber(coffeeEngine.inputs.gamepads[id].axes[axisConverted].value);
        }

        controllerButtonValue({ button, id }) {
            //Make some checks and balances
            if (!coffeeEngine.inputs.gamepads[id].buttons) return 0;
            const buttonConverted = coffeeEngine.inputs.buttonNameToID[button];
            if (!coffeeEngine.inputs.gamepads[id].buttons[buttonConverted]) return 0;

            //Get and cast
            return sugarcube.cast.toNumber(coffeeEngine.inputs.gamepads[id].buttons[buttonConverted].value);
        }

        controllerButton({ button, id }) {
            //Make some checks and balances
            if (!coffeeEngine.inputs.gamepads[id].buttons) return false;
            const buttonConverted = coffeeEngine.inputs.buttonNameToID[button];
            if (!coffeeEngine.inputs.gamepads[id].buttons[buttonConverted]) return false;

            //Get and cast
            return sugarcube.cast.toBoolean(coffeeEngine.inputs.gamepads[id].buttons[buttonConverted].pressed);
        }

        controllerID({ id }) {
            return coffeeEngine.inputs.gamepads[id].id || "none";
        }

        //Time stuff
        timer() {
            return coffeeEngine.timer;
        }

        deltaTime() {
            return coffeeEngine.runtime.deltaTime;
        }

        dayMonthYear({ timespan }) {
            this.date.setTime();
            switch (timespan) {
                case "getCentury":
                    //Get the century
                    return Math.floor(this.date.getFullYear() / 100) + 1;

                case "getDecade":
                    //Get the decade
                    return (this.date.getFullYear() / 10) % 10;

                default:
                    if (this.date[timespan]) return this.date[timespan]();
                    return 0;
            }
        }

        //Fields
        controller_Init(field) {
            field.createBorderRect_();
            field.createTextElement_();
        }

        controller_Editor(field) {
            //Style div
            const div = document.createElement("div");

            div.style.overflow = "hidden";

            div.style.width = "256px";
            div.style.height = "256px";

            div.innerHTML = this.controllerSVG;

            //Initilize button object
            let buttons = [];

            //Function to set the button value
            const setButton = (name) => {
                buttons.forEach((button) => {
                    //Loop through the buttons and highlight the selected one;
                    const objName = button.getAttribute("name");
                    if (objName == name) {
                        button.style.fill = "#47A8D1";
                    } else {
                        button.style.fill = "#2E8EB8";
                    }
                });
                field.value = name;
            };

            //Add functionality
            buttons = Array.from(div.getElementsByClassName("coffee-engine-controller-button")).map((Value) => {
                const name = Value.getAttribute("name");
                Value.onclick = () => {
                    setButton(name);
                };

                return Value;
            });

            setButton(field.value);

            //Return our div so we can put it on the field itself
            return div;
        }

        controller_Axis_Editor(field) {
            //Style div
            const div = document.createElement("div");

            div.style.overflow = "hidden";

            div.style.width = "256px";
            div.style.height = "256px";

            div.innerHTML = this.controllerAxisSVG;

            //Initilize button object
            let buttons = [];

            //Function to set the button value
            const setButton = (name) => {
                buttons.forEach((button) => {
                    //Loop through the buttons and highlight the selected one;
                    const objName = button.getAttribute("name");
                    if (objName == name) {
                        button.style.fill = "#47A8D1";
                    } else {
                        button.style.fill = "#2E8EB8";
                    }
                });
                field.value = name;
            };

            //Add functionality
            buttons = Array.from(div.getElementsByClassName("coffee-engine-controller-button")).map((Value) => {
                const name = Value.getAttribute("name");
                Value.onclick = () => {
                    setButton(name);
                };

                return Value;
            });

            setButton(field.value);

            //Return our div so we can put it on the field itself
            return div;
        }

        controller_Value_Render(value, textContent) {
            textContent.nodeValue = editor.language[`sugarcube.sensing.field.controller.${value}`] || value;
        }
    }

    sugarcube.extensionManager.registerExtension(new sensing());
})();
